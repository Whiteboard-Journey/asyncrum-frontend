"use strict";(self.webpackChunkasyncrum=self.webpackChunkasyncrum||[]).push([[581],{52581:function(e,n,t){t.r(n),t.d(n,{default:function(){return v}});var r,a,s=t(1413),o=t(15861),c=t(29439),u=t(64687),i=t.n(u),f=t(5508),p=t(5928),d=t(69976),l=t(72791),E=t(41354),A=t(10765),_=t(80184),v=function(){var e=(0,l.useState)(),n=(0,c.Z)(e,2),t=n[0],u=n[1],v=(0,(0,A.Sc)().appSelector)((function(e){return{user:e.Auth.user}})).user;(0,l.useEffect)((function(){var e=new URLSearchParams(window.location.search).get("id");"string"===typeof e&&u(e)}),[]);var h=(0,f.of)(),R=function(e,n){var t=(0,l.useState)(),s=(0,c.Z)(t,2),u=s[0],f=s[1],p=(0,l.useState)(!0),A=(0,c.Z)(p,2),_=A[0],h=A[1],R=(0,l.useCallback)((function(n){n.loadRoom(e,v.fullname?v.fullname:"Anony"),n.setIsLoading(!0),n.pause(),f(n)}),[e]),m=(0,d.z)((function(e,n,t,s){e&&void 0!==r&&void 0!==a&&a.update((function(r){Object.entries(n).forEach((function(e){var n=(0,c.Z)(e,2),t=n[0],a=n[1];a?r.shapes[t]=a:delete r.shapes[t]})),Object.entries(t).forEach((function(e){var n=(0,c.Z)(e,2),t=n[0],a=n[1];a?r.bindings[t]=a:delete r.bindings[t]})),Object.entries(e.assets).forEach((function(e){var n=(0,c.Z)(e,2),t=(n[0],n[1]);t?r.assets[t.id]=t:delete r.assets[t.id]}))}))}),60,!1),P=(0,l.useCallback)((function(){}),[]),b=(0,l.useCallback)((function(){}),[]),S=(0,d.z)((function(e,n){e&&void 0!==r&&r.isActive()&&r.updatePresence("user",n)}),60,!1);return(0,l.useEffect)((function(){if(u){window.addEventListener("beforeunload",t);var n=!0;return function(){f.apply(this,arguments)}(),function(){window.removeEventListener("beforeunload",t),n=!1}}function t(){return s.apply(this,arguments)}function s(){return(s=(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==r&&void 0!==a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.detach(a);case 4:return e.next=6,r.deactivate();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(){var e=a.getRoot(),n=JSON.parse(e.shapes.toJSON().replace(/\\\'/g,"'")),t=JSON.parse(e.bindings.toJSON()),r=JSON.parse(e.assets.toJSON());null===u||void 0===u||u.replacePageContent(n,t,r)}function f(){return f=(0,o.Z)(i().mark((function t(){var s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(s={apiKey:"",presence:{user:null===u||void 0===u?void 0:u.currentUser},syncLoopDuration:0,reconnectStreamDelay:1e3}).apiKey="".concat("cdcgj34qfu9can8ujemg"),r=new E.Client("".concat("https://api.yorkie.dev"),s),t.next=6,r.activate();case 6:return r.subscribe((function(e){if("peers-changed"===e.type){var n=e.value[a.getKey()],t=Object.values(u.room.users),r=Object.values(n).map((function(e){return e.user})).filter(Boolean);t.filter((function(e){var n=e.id;return!r.some((function(e){return e.id===n}))})).forEach((function(e){null===u||void 0===u||u.removeUser(e.id)})),null===u||void 0===u||u.updateUsers(r)}})),a=new E.Document(e),t.next=10,r.attach(a);case 10:return a.update((function(e){e.shapes||(e.shapes={}),e.bindings||(e.bindings={}),e.assets||(e.assets={})}),"create shapes/bindings/assets object if not exists"),a.subscribe((function(e){"remote-change"===e.type&&c()})),t.next=14,r.sync();case 14:n&&(c(),u&&(u.zoomToFit(),u.zoom>1&&u.resetZoom(),u.setIsLoading(!1)),h(!1)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.error(t.t0);case 20:case"end":return t.stop()}}),t,null,[[0,17]])}))),f.apply(this,arguments)}}),[u]),{onMount:R,onChangePage:m,onUndo:P,onRedo:b,loading:_,onChangePresence:S}}(t||"default"),m=Object.assign({},R),P=function(){var e=(0,l.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,c,u,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("".concat("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL","?fileName=").concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return c=e.sent,u=c.uploadURL,f=c.fileUrl,e.next=12,fetch(u,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]),n=(0,l.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",Object.entries(n.assets).forEach((function(e){var n=(0,c.Z)(e,2),a=(n[0],n[1]);if(t===a.id){var s=a.src;r=s.split("/")[4]}})),e.next=4,fetch("".concat({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://api.asyncrum.com",REACT_APP_WEB_URL:"http://www.asyncrum.com",REACT_APP_YORKIE_URL:"https://api.yorkie.dev",REACT_APP_YORKIE_API_KEY:"cdcgj34qfu9can8ujemg",REACT_APP_JITSI_URL:"jitsi.asyncrum.com",REACT_APP_AWS_PRESIGNED_URL_ADDR:"https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL",REACT_APP_FIREBASE_APIKEY:"AIzaSyADFwiyQqDxUxehYKKhs6LzlUYtKOfOoS4",REACT_APP_FIREBASE_AUTH_DOMAIN:"asyncrum.firebaseapp.com",REACT_APP_FIREBASE_PROJECTID:"asyncrum",REACT_APP_FIREBASE_STORAGEBUCKET:"asyncrum.appspot.com",REACT_APP_FIREBASE_MESSAGINGSENDERID:"586881315432",REACT_APP_FIREBASE_APPID:"1:586881315432:web:01354de0665f2d4b6881dd",REACT_APP_FIREBASE_MEASUREMENTID:"G-CDKERB6JDW",REACT_APP_FIREBASE_VAPIDKEY:"BH1uHCFYDjrGQwexi004ERaiKaJiTYIw279O7oTXkD0srKxY0J0sQSdEa2o91KJ-66BfoL6k0T1FjVp2_9dklv8"}.REACT_APP_AWS_DELETE_OBJECT_ADDR,"?fileName=").concat(r));case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[]),t=(0,l.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,c,u,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("".concat("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL","?fileName=").concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return c=e.sent,u=c.uploadURL,f=c.fileUrl,e.next=12,fetch(u,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]);return{onAssetCreate:e,onAssetDelete:n,onAssetUpload:t}}(),b=Object.assign({},P);return(0,_.jsx)("div",{children:(0,_.jsx)(f.Dr,(0,s.Z)((0,s.Z)((0,s.Z)({autofocus:!0,disableAssets:!1,showPages:!1},b),h),m))})}}}]);
//# sourceMappingURL=581.06c2d6ce.chunk.js.map