"use strict";(self.webpackChunkasyncrum=self.webpackChunkasyncrum||[]).push([[581],{52581:function(e,n,t){t.r(n),t.d(n,{default:function(){return y}});var r,a,s=t(1413),o=t(15861),u=t(29439),c=t(64687),i=t.n(c),f=t(5508),p=t(5928),l=t(69976),d=t(72791),v=t(41354),h=t(10765),b=t(80184),m=new URLSearchParams(window.location.search),g=m.get("id"),w=m.get("url"),y=function(){var e=(0,(0,h.Sc)().appSelector)((function(e){return{user:e.Auth.user}})).user;var n=(0,f.of)(),t=function(n,t){var s=(0,d.useState)(),c=(0,u.Z)(s,2),f=c[0],p=c[1],h=(0,d.useState)(!0),b=(0,u.Z)(h,2),m=b[0],g=b[1],w=(0,d.useCallback)(function(){var t=(0,o.Z)(i().mark((function t(r){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(e),r.loadRoom(n,e.fullname?e.fullname:"Anony"),r.setIsLoading(!0),r.pause(),p(r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[n,t]),y=(0,l.z)((function(e,n,t,s){e&&void 0!==r&&void 0!==a&&a.update((function(r){Object.entries(n).forEach((function(e){var n=(0,u.Z)(e,2),t=n[0],a=n[1];a?r.shapes[t]=a:delete r.shapes[t]})),Object.entries(t).forEach((function(e){var n=(0,u.Z)(e,2),t=n[0],a=n[1];a?r.bindings[t]=a:delete r.bindings[t]})),Object.entries(e.assets).forEach((function(e){var n=(0,u.Z)(e,2),t=(n[0],n[1]);t?r.assets[t.id]=t:delete r.assets[t.id]}))}))}),60,!1),x=(0,d.useCallback)((function(){}),[]),k=(0,d.useCallback)((function(){}),[]),U=(0,l.z)((function(e,n){e&&void 0!==r&&r.isActive()&&r.updatePresence("user",n)}),60,!1);return(0,d.useEffect)((function(){if(f){window.addEventListener("beforeunload",t);var e=!0;return function(){u.apply(this,arguments)}(),function(){window.removeEventListener("beforeunload",t),e=!1}}function t(){void 0!==r&&void 0!==a&&(r.detach(a),r.deactivate())}function s(){var e=a.getRoot(),n=JSON.parse(e.shapes.toJSON().replace(/\\'/g,"'")),t=JSON.parse(e.bindings.toJSON()),r=JSON.parse(e.assets.toJSON());null===f||void 0===f||f.replacePageContent(n,t,r)}function u(){return u=(0,o.Z)(i().mark((function t(){var o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={presence:{user:null===f||void 0===f?void 0:f.currentUser},syncLoopDuration:0,reconnectStreamDelay:1e3},r=new v.Client("https://api.asyncrum.com:8090",o),t.next=5,r.activate();case 5:return r.subscribe((function(e){if("peers-changed"===e.type){var n=e.value[a.getKey()],t=Object.values(f.room.users),r=Object.values(n).map((function(e){return e.user})).filter(Boolean);t.filter((function(e){var n=e.id;return!r.some((function(e){return e.id===n}))})).forEach((function(e){null===f||void 0===f||f.removeUser(e.id)})),null===f||void 0===f||f.updateUsers(r)}})),a=new v.Document(n),t.next=9,r.attach(a);case 9:return a.update((function(e){e.shapes||(e.shapes={}),e.bindings||(e.bindings={}),e.assets||(e.assets={})}),"create shapes/bindings/assets object if not exists"),a.subscribe((function(e){"remote-change"===e.type&&s()})),t.next=13,r.sync();case 13:e&&(s(),f&&(f.zoomToFit(),f.zoom>1&&f.resetZoom(),f.setIsLoading(!1)),g(!1)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),console.error(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])}))),u.apply(this,arguments)}}),[f]),{onMount:w,onChangePage:y,onUndo:x,onRedo:k,loading:m,onChangePresence:U}}(g||"temp",w||""),c=Object.assign({},t),m=function(){var e=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,u,c,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL?fileName=".concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return u=e.sent,c=u.uploadURL,f=u.fileUrl,e.next=12,fetch(c,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]),n=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[]),t=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,u,c,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL?fileName=".concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return u=e.sent,c=u.uploadURL,f=u.fileUrl,e.next=12,fetch(c,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]);return{onAssetCreate:e,onAssetDelete:n,onAssetUpload:t}}(),y=Object.assign({},m);return(0,b.jsx)("div",{children:(0,b.jsx)(f.Dr,(0,s.Z)((0,s.Z)((0,s.Z)({autofocus:!0,disableAssets:!1,showPages:!1},y),n),c))})}}}]);
//# sourceMappingURL=581.3b3d67e2.chunk.js.map