"use strict";(self.webpackChunkasyncrum=self.webpackChunkasyncrum||[]).push([[581],{52581:function(e,n,t){t.r(n),t.d(n,{default:function(){return w}});var r,a,s=t(1413),o=t(15861),u=t(29439),c=t(64687),i=t.n(c),f=t(56819),p=t(5928),l=t(69976),d=t(72791),v=t(41354),h=t(80184),b=new URLSearchParams(window.location.search),m=b.get("id"),g=b.get("url"),y=JSON.parse(sessionStorage.getItem("asyncrum_user")),w=function(){var e=(0,f.of)(),n=function(e,n){var t=(0,d.useState)(),s=(0,u.Z)(t,2),c=s[0],f=s[1],p=(0,d.useState)(!0),h=(0,u.Z)(p,2),b=h[0],m=h[1],g=(0,d.useCallback)(function(){var n=(0,o.Z)(i().mark((function n(t){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log(y),t.loadRoom(e,y.fullname?y.fullname:"Anony"),t.setIsLoading(!0),t.pause(),f(t);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[e,n]),w=(0,l.z)((function(e,n,t,s){e&&void 0!==r&&void 0!==a&&a.update((function(r){Object.entries(n).forEach((function(e){var n=(0,u.Z)(e,2),t=n[0],a=n[1];a?r.shapes[t]=a:delete r.shapes[t]})),Object.entries(t).forEach((function(e){var n=(0,u.Z)(e,2),t=n[0],a=n[1];a?r.bindings[t]=a:delete r.bindings[t]})),Object.entries(e.assets).forEach((function(e){var n=(0,u.Z)(e,2),t=(n[0],n[1]);t?r.assets[t.id]=t:delete r.assets[t.id]}))}))}),60,!1),x=(0,d.useCallback)((function(){}),[]),k=(0,d.useCallback)((function(){}),[]),U=(0,l.z)((function(e,n){e&&void 0!==r&&r.isActive()&&r.updatePresence("user",n)}),60,!1);return(0,d.useEffect)((function(){if(c){window.addEventListener("beforeunload",t);var n=!0;return function(){u.apply(this,arguments)}(),function(){window.removeEventListener("beforeunload",t),n=!1}}function t(){void 0!==r&&void 0!==a&&(r.detach(a),r.deactivate())}function s(){var e=a.getRoot(),n=JSON.parse(e.shapes.toJSON().replace(/\\\'/g,"'")),t=JSON.parse(e.bindings.toJSON()),r=JSON.parse(e.assets.toJSON());null===c||void 0===c||c.replacePageContent(n,t,r)}function u(){return u=(0,o.Z)(i().mark((function t(){var o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={presence:{user:null===c||void 0===c?void 0:c.currentUser},syncLoopDuration:0,reconnectStreamDelay:1e3},r=new v.Client("https://api.asyncrum.com:8090",o),t.next=5,r.activate();case 5:return r.subscribe((function(e){if("peers-changed"===e.type){var n=e.value[a.getKey()],t=Object.values(c.room.users),r=Object.values(n).map((function(e){return e.user})).filter(Boolean);t.filter((function(e){var n=e.id;return!r.some((function(e){return e.id===n}))})).forEach((function(e){null===c||void 0===c||c.removeUser(e.id)})),null===c||void 0===c||c.updateUsers(r)}})),a=new v.Document(e),t.next=9,r.attach(a);case 9:return a.update((function(e){e.shapes||(e.shapes={}),e.bindings||(e.bindings={}),e.assets||(e.assets={})}),"create shapes/bindings/assets object if not exists"),a.subscribe((function(e){"remote-change"===e.type&&s()})),t.next=13,r.sync();case 13:n&&(s(),c&&(c.zoomToFit(),c.zoom>1&&c.resetZoom(),c.setIsLoading(!1)),m(!1)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),console.error(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])}))),u.apply(this,arguments)}}),[c]),{onMount:g,onChangePage:w,onUndo:x,onRedo:k,loading:b,onChangePresence:U}}(m||"temp",g||""),t=Object.assign({},n),c=function(){var e=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,u,c,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL?fileName=".concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return u=e.sent,c=u.uploadURL,f=u.fileUrl,e.next=12,fetch(c,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]),n=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[]),t=(0,d.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(n,t,r){var a,s,o,u,c,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=encodeURIComponent((null!==r&&void 0!==r?r:p.cQ.uniqueId())+"-"+t.name),s=encodeURIComponent(t.type),e.next=4,fetch("https://toygu5z9eb.execute-api.ap-northeast-2.amazonaws.com/default/getPresignedURL?fileName=".concat(a,"&fileType=").concat(s));case 4:return o=e.sent,e.next=7,o.json();case 7:return u=e.sent,c=u.uploadURL,f=u.fileUrl,e.next=12,fetch(c,{method:"PUT",body:t});case 12:if(e.sent.ok){e.next=15;break}return e.abrupt("return",!1);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e)})));return function(n,t,r){return e.apply(this,arguments)}}(),[]);return{onAssetCreate:e,onAssetDelete:n,onAssetUpload:t}}(),b=Object.assign({},c);return(0,h.jsx)("div",{children:(0,h.jsx)(f.Dr,(0,s.Z)((0,s.Z)((0,s.Z)({autofocus:!0,disableAssets:!1,showPages:!1},b),e),t))})}}}]);
//# sourceMappingURL=581.ccb7e0f7.chunk.js.map